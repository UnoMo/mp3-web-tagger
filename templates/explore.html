{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>Explore uploaded MP3s</h2>

  {% if files %}
    <p class="muted">
      Files are stored in <code>instance/uploads</code>.
      You can download, edit tags, or delete them.
    </p>

    <form method="post">
      <table>
        <thead>
          <tr>
            <th>
              <input type="checkbox"
                     onclick="for (const cb of document.querySelectorAll('.filecheck')) { cb.checked = this.checked; }">
            </th>
            <th>Cover</th>
            <th>Filename</th>
            <th>Title / Artist</th>
            <th>Size</th>
            <th>Modified</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for f in files %}
          <tr>
            <td>
              <input class="filecheck" type="checkbox" name="files" value="{{ f.name }}">
            </td>

            <td style="width:70px;">
              {% if f.thumb %}
                <img src="{{ f.thumb }}"
                     alt="cover"
                     class="cover-thumb">
              {% else %}
                <span class="muted">—</span>
              {% endif %}
            </td>

            <td style="word-break:break-all;">
              {{ f.name }}
            </td>

            <td>
              {% if f.title or f.artist %}
                <div><strong>{{ f.title or '—' }}</strong></div>
                <div class="muted">{{ f.artist or '' }}</div>
              {% else %}
                <span class="muted">No tags</span>
              {% endif %}
            </td>

            <td style="white-space:nowrap;">
              {{ f.size_human }}
            </td>

            <td style="white-space:nowrap;">
              {{ f.mtime_human }}
            </td>

            <td>
              <div class="actions">
                <a class="btn" href="{{ url_for('download_updated', filename=f.name) }}">Download</a>

                <form class="inline"
                      action="{{ url_for('delete_file', filename=f.name) }}"
                      method="post"
                      onsubmit="return confirm('Delete {{ f.name }}? This cannot be undone.');">
                  <button class="btn danger" type="submit">
                    Delete
                  </button>
                </form>

                <a class="btn" href="{{ url_for('edit', filename=f.name) }}">Edit tags</a>
              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      <div class="actions" style="margin-top:1rem">
        <button class="btn"
                type="submit"
                formaction="{{ url_for('download_bulk') }}">
          Download selected
        </button>

        <button class="btn danger"
                type="submit"
                formaction="{{ url_for('delete_bulk') }}"
                onclick="return confirm('Delete selected files? This cannot be undone.');">
          Delete selected
        </button>
      </div>
    </form>

  {% else %}
    <p class="muted">No files uploaded yet.</p>
  {% endif %}
</div>

{% endblock %}
